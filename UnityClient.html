<!DOCTYPE html>
<html>
<head>
  <!-- Site made with Mobirise Website Builder v3.11, https://mobirise.com -->
  <meta charset="UTF-8">
<meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
<meta http-equiv="Pragma" content="no-cache" />
<meta http-equiv="Expires" content="0" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="generator" content="Mobirise v3.11, mobirise.com">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="shortcut icon" href="favicon.ico" type="image/x-icon">
  <meta name="description" content="Web Site Generator Description">
  <title>MW Unity Client</title>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic&amp;subset=latin">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Montserrat:400,700">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Raleway:100,100i,200,200i,300,300i,400,400i,500,500i,600,600i,700,700i,800,800i,900,900i">
  <link rel="stylesheet" href="assets/bootstrap-material-design-font/css/material.css">
  <link rel="stylesheet" href="assets/web/assets/mobirise-icons/mobirise-icons.css">
  <link rel="stylesheet" href="assets/et-line-font-plugin/style.css">
  <link rel="stylesheet" href="assets/tether/tether.min.css">
  <link rel="stylesheet" href="assets/bootstrap/css/bootstrap.min.css">
  <link rel="stylesheet" href="assets/dropdown/css/style.css">
  <link rel="stylesheet" href="assets/theme/css/style.css">
  <link rel="stylesheet" href="assets/mobirise/css/mbr-additional.css" type="text/css">
  
  
  
</head>
<body>
<section id="menu-36">

    <nav class="navbar navbar-dropdown bg-color transparent navbar-fixed-top" style="background-color:rgba(0,0,0,0.75);">
        <div class="container">

            <div class="mbr-table">
                <div class="mbr-table-cell">

                    <div class="navbar-brand">
                        <a href="http://icat.vt.edu/" target="_blank" class="navbar-logo"><img src="assets/images/icat-vt-lockup-cmyk-396x128.png" alt="Mobirise"></a>
                        <a class="navbar-caption text-danger" href="https://mobirise.com"></a>
                    </div>

                </div>
                <div class="mbr-table-cell">

                    <button class="navbar-toggler pull-xs-right hidden-md-up" type="button" data-toggle="collapse" data-target="#exCollapsingNavbar">
                        <div class="hamburger-icon"></div>
                    </button>

                    <ul class="nav-dropdown collapse pull-xs-right nav navbar-nav navbar-toggleable-sm" id="exCollapsingNavbar"><li class="nav-item"><a class="nav-link link" href="index.html">Home</a></li><li class="nav-item"><a class="nav-link link" href="overview.html">Overview</a></li><li class="nav-item dropdown"><a class="nav-link link dropdown-toggle" data-toggle="dropdown-submenu" href="https://mobirise.com/" aria-expanded="false">Research</a><div class="dropdown-menu"><a class="dropdown-item" href="ResearchOverview.html">Overview</a><a class="dropdown-item" href="cv.html">Computer Vision</a><a class="dropdown-item" href="server.html">Server</a><div class="dropdown"><a class="dropdown-item dropdown-toggle" href="client.html" data-toggle="dropdown-submenu" aria-expanded="false">Client</a><div class="dropdown-menu dropdown-submenu"><a class="dropdown-item" href="UnityClient.html">Unity</a><a class="dropdown-item" href="X3D.html">X3D</a></div></div><a class="dropdown-item" href="infrastructure.html">Research Infrastructure</a></div></li><li class="nav-item"><a class="nav-link link" href="application.html" aria-expanded="false">Applications</a></li><li class="nav-item dropdown open"><a class="nav-link link dropdown-toggle" href="application.html" aria-expanded="true" data-toggle="dropdown-submenu">More</a><div class="dropdown-menu"><a class="dropdown-item" href="people.html">People</a><a class="dropdown-item" href="links.html">Links</a><a class="dropdown-item" href="https://webapps.es.vt.edu/confluence/display/IMW/">Confluence</a></div></li></ul>
                    <button hidden="" class="navbar-toggler navbar-close" type="button" data-toggle="collapse" data-target="#exCollapsingNavbar">
                        <div class="close-icon"></div>
                    </button>

                </div>
            </div>

        </div>
    </nav>

</section>





<section class="engine"><a rel="external" href="https://mobirise.com">mobirise.com</a></section><section class="mbr-section article mbr-parallax-background mbr-after-navbar" id="msg-box8-v" style="background:linear-gradient(to bottom, #4b7199 0%, #5a82a9 40%, #98c8ea 100%); padding-top: 160px; padding-bottom: 160px;">

  
    <div class="container">
        <div class="row">
            <div class="col-md-8 col-md-offset-2 text-xs-center">
                <h3 class="mbr-section-title display-2">Unity Client</h3>
                <div class="lead"></div>
                
            </div>
        </div>
    </div>

</section>




<section class="mbr-section article mbr-section__container" id="content1-1y" style="background-color: rgb(255, 255, 255); padding-top: 20px; padding-bottom: 20px;">

    <div class="container">
        <div class="row">
            <div class="col-xs-12 lead"><p>Modeling the real world into the virtual world is the first step in this process. This involves using Unity and Maya in tandem. There are other 3D modelling software which are compatible with Unity such as Blender and Rhinoceros. In other words, if the software has the ability to save work as a .fbx or a .obj it will be compatible with the Unity engine. The objects are modelled individually in pieces in Maya (keep in mind that the polygon count should be low so as not to bog down the system by taking up too much memory), then imported into Unity. Textures and color are added to the objects from within Unity (textures should also be such that they are not too heavy for the overall system). Once the world has been created virtually, an avatar to represent people must be selected/created and imported. These avatars will appear whenever people in the real world are within the bounds of the real world cameras designated for the project. It is best to use an ambiguous figure that has no distinct front, back, top or bottom. Finally, in Unity, cameras must be placed in the virtual world in the same location and height as the “mirror” tablets that will be installed in the real world. The cameras in the Unity scene should include a script to invert the camera’s visual output. In other words, when Unity is running on the tablets in the real world, what is seen should be equivalent to looking into a mirror. It is important to have an organized system for creating and adding new objects to the the virtual world. For example, when modeling a room, each wall is its own object. Each chair, table, door, etc. are their own objects. However, once they are added to the scene, they should all be grouped together under a parent game object which represents that room as a whole. Keeping the modeled objects organized by room are important if future changes ever need to be made or if things get reorganized. Also, it’s important to remember wall thicknesses when modeling. This will keep the overall model accurate in order to make it possible to establish a global coordinate system that will also be used by the cameras responsible for tracking people in the real world. Other views and modes of interacting with the world can then be implemented. Unity provides a first person camera and corresponding controllers. This is a mobile camera which can be controlled using the mouse and the arrow keys. Unity also allows for multiplayer networking. For this project, it means that people on their computers at home can navigate through the world in a first person point of view and their avatars will be seen in the “mirror” tablets that are mounted in the real world space. It the Unity asset store, a multiplayer networking package is provided. This package provides the foundation for the multiplayer functionality, but more work must be done in order to ensure the networking code does not interfere with the SocketIO code. From there, it is time to install and implement SocketIO. 
</p>

<p><br></p>
<p><br></p>

<p>
The SocketIO library is used by creating an object with a SocketIOComponent script component attached to it. The script instance can then be obtained from other sections of Unity code by use of the GameObject.Find() and GameObject.getComponent() function calls. Once the instance is obtained, the socket’s callbacks should be specified. This can be done by use of the function, SocketIOComponent.On(string socket name, function f). The first argument specifies the name of the network callback to listen on, and the second argument specifies the function that should be called whenever a network signal on that callback is received. Each such function must accept a single argument, a SocketIOEvent object.
</p>

<p><br></p>
<p>

For this project, 5 callbacks were specified: connect, newBlob, updateBlob, removeBlob, and disconnect, each with their own respective function. The connect and disconnect callbacks are self explanatory. The newBlob callback is used whenever a new user is detected from the opencv blob detection program. updateBlob is called whenever an already existing blob receives an update, which should be many times in a second under ideal circumstances. The removeBlob callback is used when tracking is lost on a blob. Each network callback function has access to a SocketIOEvent object, passed in by the SocketIO library as an argument. The SocketIOEvent concerns a single blob, and contains a field “data” which represents a JSON object containing relevant information about the event such as camera id, blob id, and blob position.
</p>

<p><br></p>
<p>

The information received from the serve in the SocketIOEvent object is stored in a CSharp Dictionary object in order to keep track of the current model state. The key to the dictionary is a unique integer identifier for the blob, which is a hash computed by combining the blob id and the camera id of the event. Since multiple cameras are in use, simply using the blob id field will not be sufficient, as duplicates will be present. This issue was causing random, nondeterministic behaviour earlier in the semester because a only the blob id was being used. The hash is computed by doing a left bit shift on the cameraId and bitwise ORing that value with the blob id. The current shift amount is 22, which allows for roughly 1,000 different camera ids and over 4,000,000 blobs for each camera. In the event that either of these limits are reached, the key will not necessarily be unique; however, reaching either limit is doubtful in the near future for this project. A simple solution for future expansion would be to use a long for the key to allow more bits for both values. 
</p>

<p><br></p>
<p>

The values in the dictionary are instances of the Blob class, which store relevant blob information such as blob id, camera id, and the corresponding Unity GameObject that represents the actual blob that is rendered in 3D space. When a signal is given to create a blob, a new GameObject is created. It is an instantiated clone of the personMarker field, which can be quickly specified from within the Unity editor as any prefab object. When updates are received, the coordinates of the clone are altered accordingly, which automatically updates the respective visuals on the client displays.

</p>

</div>
        </div>
    </div>

</section>

<section class="mbr-section mbr-section__container" id="image2-1z" style="background-color: rgb(255, 255, 255); padding-top: 80px; padding-bottom: 80px;">
    <div class="container">
        <div class="row">
            <div class="col-xs-12">
                <figure class="mbr-figure">
                    <div><img src="assets/images/virtualworld-screenshot-1400x787.png"></div>

                    

                </figure>
            </div>
        </div>
    </div>
</section>

<section class="mbr-cards mbr-section mbr-section-nopadding" id="features6-3q" style="background-color: rgb(239, 239, 239);">

    

    <div class="mbr-cards-row row">
        <div class="mbr-cards-col col-xs-12 col-lg-3" style="padding-top: 80px; padding-bottom: 80px;">
            <div class="container">
              <div class="card cart-block">
                  <div class="card-img"><a href="cv.html" class="etl-icon icon-camera mbr-iconfont mbr-iconfont-features3"></a></div>
                  <div class="card-block">
                    <h4 class="card-title">Computer Vision</h4>
                    
                    
                    <div class="card-btn"><a href="cv.html" class="btn btn-primary">MORE</a></div>
                    </div>
                </div>
            </div>
        </div>
        <div class="mbr-cards-col col-xs-12 col-lg-3" style="padding-top: 80px; padding-bottom: 80px;">
            <div class="container">
                <div class="card cart-block">
                    <div class="card-img"><a href="server.html" class="etl-icon icon-gears mbr-iconfont mbr-iconfont-features3"></a></div>
                    <div class="card-block">
                        <h4 class="card-title">Server</h4>
                        
                        
                        <div class="card-btn"><a href="server.html" class="btn btn-primary">MORE</a></div>
                    </div>
                </div>
            </div>
        </div>
        <div class="mbr-cards-col col-xs-12 col-lg-3" style="padding-top: 80px; padding-bottom: 80px;">
            <div class="container">
                <div class="card cart-block">
                    <div class="card-img"><a href="UnityClient.html" class="mbri-users mbr-iconfont mbr-iconfont-features3"></a></div>
                    <div class="card-block">
                        <h4 class="card-title">Client</h4>
                        
                        
                        <div class="card-btn"><a href="UnityClient.html" class="btn btn-primary">MORE</a></div>
                    </div>
                </div>
            </div>
        </div>
        <div class="mbr-cards-col col-xs-12 col-lg-3" style="padding-top: 80px; padding-bottom: 80px;">
            <div class="container">
                <div class="card cart-block">
                    <div class="card-img"><a href="infrastructure.html" class="etl-icon icon-tools-2 mbr-iconfont mbr-iconfont-features3"></a></div>
                    <div class="card-block">
                        <h4 class="card-title">Research Infrastructure</h4>
                        
                        
                        <div class="card-btn"><a href="infrastructure.html" class="btn btn-primary">MORE</a></div>
                    </div>
                </div>
            </div>
        </div>
        
        
    </div>
</section>

    <section class="mbr-section mbr-section-md-padding mbr-footer footer1" id="contacts1-2q" style="background-color: rgb(0, 0, 0); padding-top: 30px; padding-bottom: 30px;">

        <div class="container">
            <div class="row">
                
                <div class="mbr-footer-content col-xs-6 col-md-4">
                    <p>This research is supported by the National Science Foundation under Grants No. 1305231.</p>
                </div>

                <div class="mbr-footer-content col-xs-6 col-md-4">
                
                </div>
               
                <div class="mbr-footer-content col-xs-6 col-md-4">
                    <p>Website created by Nuo Ma.<br>Design courtesy: Mobirise.</p>
                </div>

            </div>
        </div>
    </section>


  <script src="assets/web/assets/jquery/jquery.min.js"></script>
  <script src="assets/tether/tether.min.js"></script>
  <script src="assets/bootstrap/js/bootstrap.min.js"></script>
  <script src="assets/smooth-scroll/SmoothScroll.js"></script>
  <script src="assets/dropdown/js/script.min.js"></script>
  <script src="assets/touchSwipe/jquery.touchSwipe.min.js"></script>
  <script src="assets/jarallax/jarallax.js"></script>
  <script src="assets/theme/js/script.js"></script>
  
  <script>
        (function (i, s, o, g, r, a, m) {
        i['GoogleAnalyticsObject'] = r; i[r] = i[r] || function () {
            (i[r].q = i[r].q || []).push(arguments)
        }, i[r].l = 1 * new Date(); a = s.createElement(o),
            m = s.getElementsByTagName(o)[0]; a.async = 1; a.src = g; m.parentNode.insertBefore(a, m)
        })(window, document, 'script', 'https://www.google-analytics.com/analytics.js', 'ga');

        ga('create', 'UA-91771580-1', 'auto');
        ga('send', 'pageview');

    </script>
 <div id="scrollToTop" class="scrollToTop mbr-arrow-up"><a style="text-align: center;"><i class="mbr-arrow-up-icon"></i></a></div>
  </body>
</html>